import pytest
from usecase.exportLabelme.coco2labelme.coco2LabelmeConverter import CoCo2LabelmeConverter
from usecase.util.jsonHelper import JsonHelper


@pytest.fixture()
def coco_json_string():
    import os
    base_dir = os.path.dirname(__file__)
    return JsonHelper.load_json_string(base_dir + '/test_data/machine_coco.json')

class TestCase:

    def test_shape_converted_successfully(self, coco_json_string):
        converter = CoCo2LabelmeConverter()

        result = converter.convert_to_labelme(coco_json_string)

        result['Labels'][0]['Shapes'][0] == {'Type': 'circle', 'Score': 100, 'manualPoints': [], 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': [], 'points': [[947, 1127], [943, 1126], [922, 1151], [922, 1156], [925, 1155], [945, 1133]], 'Attributes': {}}


    def test_convert__coco_to_labelme_format(self, coco_json_string):
        converter = CoCo2LabelmeConverter()
    
        result = converter.convert_to_labelme(coco_json_string)

        assert result == self.expected_labelme_format()
    
    def expected_labelme_format(self):
        return {'Labels': [{'Label': 'wire', 'Shapes': [{'Type': 'circle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[947, 1127], [943, 1126], [922, 1151], [922, 1156], [925, 1155], [945, 1133]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[852, 1124], [846, 1130], [839, 1143], [834, 1149], [831, 1157], [835, 1157], [847, 1141], [854, 1129], [854, 1126]], 'Attributes': {}}, {'Type': 'circle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1031, 1114], [1025, 1118], [996, 1151], [999, 1154], [1005, 1150], [1033, 1119]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[398, 1107], [396, 1109], [396, 1112], [419, 1153], [423, 1157], [428, 1159], [427, 1154], [409, 1124], [404, 1113]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[7, 898], [8, 915], [9, 902]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1003, 803], [1004, 813], [1018, 850], [1031, 891], [1039, 912], [1043, 917], [1046, 915], [1045, 907], [1031, 870], [1011, 808], [1007, 802]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1039, 779], [1039, 783], [1045, 787], [1134, 821], [1139, 820], [1139, 818], [1136, 815], [1123, 811], [1078, 792], [1064, 788], [1045, 779]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[7, 779], [8, 784], [96, 819], [103, 819], [102, 815], [95, 811], [82, 807], [44, 791]], 'Attributes': {}}, {'Type': 'circle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[7, 583], [8, 590], [75, 627], [88, 631], [88, 627], [83, 623]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[699, 579], [695, 579], [580, 635], [536, 653], [525, 659], [523, 663], [528, 664], [633, 617], [696, 586], [699, 583]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[799, 559], [795, 559], [792, 562], [779, 582], [734, 659], [591, 891], [588, 899], [590, 901], [592, 901], [596, 897], [611, 874], [705, 716], [796, 568]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[316, 547], [319, 549], [330, 550], [451, 551], [622, 557], [626, 555], [624, 551], [527, 547], [392, 545], [327, 542], [318, 543]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[795, 534], [757, 577], [737, 604], [578, 799], [495, 895], [495, 900], [499, 899], [516, 882], [582, 805], [757, 588], [779, 563], [797, 539], [797, 536]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[795, 510], [790, 512], [769, 533], [675, 633], [578, 732], [506, 808], [442, 872], [408, 903], [405, 907], [407, 911], [411, 910], [437, 887], [535, 788], [608, 710], [796, 515]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[807, 459], [807, 463], [819, 471], [833, 477], [963, 550], [1111, 630], [1123, 635], [1125, 631], [1120, 627], [1017, 573], [811, 459]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[314, 451], [317, 455], [339, 461], [427, 481], [591, 523], [604, 525], [621, 530], [626, 528], [623, 524], [613, 521], [583, 515], [565, 509], [512, 497], [468, 485], [377, 463], [368, 462], [321, 449], [315, 449]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1125, 358], [1118, 357], [1079, 367], [1028, 377], [829, 423], [814, 425], [809, 427], [807, 431], [811, 433], [822, 431], [834, 427], [848, 425], [1017, 385], [1114, 365], [1123, 362]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[89, 355], [87, 353], [82, 353], [30, 367], [7, 371], [7, 378], [86, 359]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1127, 267], [1125, 264], [1122, 264], [1048, 293], [1028, 299], [951, 329], [919, 343], [911, 345], [884, 357], [766, 400], [760, 403], [759, 407], [765, 408], [780, 403], [1004, 314], [1122, 271]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[91, 260], [83, 260], [63, 269], [10, 288], [7, 290], [7, 295], [86, 267], [91, 263]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[633, 254], [630, 257], [630, 365], [631, 400], [635, 403], [637, 400], [636, 255]], 'Attributes': {}}, {'Type': 'circle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[419, 251], [415, 248], [322, 251], [320, 255], [322, 257], [414, 255]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[947, 88], [942, 91], [887, 162], [715, 357], [693, 385], [638, 448], [637, 451], [639, 453], [643, 451], [724, 356], [891, 167], [943, 101], [949, 91]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[855, 87], [852, 88], [848, 93], [844, 102], [797, 179], [651, 398], [637, 421], [635, 427], [639, 428], [643, 424], [704, 328], [808, 173], [856, 92]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1035, 79], [1031, 79], [962, 154], [864, 253], [639, 472], [639, 477], [643, 477], [915, 211], [1003, 120], [1033, 85]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[399, 71], [400, 76], [409, 94], [418, 109], [464, 199], [471, 209], [474, 208], [475, 205], [473, 199], [403, 70]], 'Attributes': {}}]}, {'Label': 'bond_rec', 'Shapes': [{'Type': 'rectangle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[534, 6], [613, 6], [613, 117], [534, 117]], 'Attributes': {}}, {'Type': 'circle', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[438.6, 5.1], [517.5, 1.5], [522.6, 112.3], [443.6, 115.9]], 'Attributes': {}}]}, {'Label': 'wire_2', 'Shapes': [{'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[806, 580], [804, 583], [825, 618], [893, 721], [899, 727], [901, 727], [902, 723], [852, 649], [809, 581]], 'Attributes': {}}]}, {'Label': 'bond_90', 'Shapes': [{'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[227, 627], [227, 649], [229, 653], [247, 653], [274, 668], [318, 668], [327, 663], [330, 655], [330, 620], [326, 615], [318, 612], [272, 611], [249, 622], [241, 624], [231, 623]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[227, 723], [227, 745], [229, 749], [247, 749], [274, 764], [318, 764], [327, 759], [330, 751], [330, 716], [326, 711], [318, 708], [272, 707], [249, 718], [241, 720], [231, 719]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,128', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[228, 531], [228, 553], [230, 557], [248, 557], [275, 572], [319, 572], [328, 567], [331, 559], [331, 524], [327, 519], [319, 516], [273, 515], [250, 526], [242, 528], [232, 527]], 'Attributes': {}}]}, {'Label': 'bottle', 'Shapes': [{'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,255', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[651, 7.1], [651, 11.1], [653, 14.1], [652, 30.1], [640, 55.1], [640, 88.1], [643, 103.1], [646, 108.1], [690, 109.1], [694, 106.1], [698, 96.1], [699, 62.1], [698, 53.1], [689, 37.1], [683, 19.1], [685, 11.1], [688, 8.1], [688, 5.1], [653, 6.1]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,255', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[746.9, 7.4], [746.9, 11.4], [748.9, 14.4], [747.9, 30.4], [736, 55.4], [736.1, 88.4], [739.2, 103.4], [742.2, 108.4], [786.2, 109.3], [790.2, 106.2], [794.2, 96.2], [795.1, 62.2], [794, 53.2], [785, 37.3], [778.9, 19.3], [780.9, 11.3], [783.9, 8.3], [783.9, 5.3], [748.9, 6.4]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,255', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[843, 7.3], [843, 11.3], [844.9, 14.3], [843.9, 30.3], [831.9, 55.3], [831.9, 88.3], [834.9, 103.3], [837.9, 108.3], [881.9, 109.3], [885.9, 106.3], [889.9, 96.3], [890.9, 62.3], [889.9, 53.3], [880.9, 37.3], [874.9, 19.3], [877, 11.3], [880, 8.3], [880, 5.3], [845, 6.3]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,255', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[938.9, 8.2], [938.9, 12.2], [940.9, 15.2], [939.8, 31.2], [927.7, 56.1], [927.6, 89.1], [930.5, 104.1], [933.5, 109.2], [977.5, 110.3], [981.5, 107.3], [985.6, 97.3], [986.7, 63.3], [985.7, 54.3], [976.8, 38.3], [970.8, 20.3], [972.9, 12.3], [975.9, 9.3], [975.9, 6.3], [940.9, 7.2]], 'Attributes': {}}, {'Type': 'polygon', 'Score': 100, 'manualPoints': None, 'iou': -1, 'vertex_color': '0,255,0,255', 'line_color': '0,255,0,255', 'fill_color': '255,0,0,128', 'IgnoreShapes': None, 'points': [[1034.7, 6.3], [1034.8, 10.3], [1036.9, 13.3], [1036.3, 29.3], [1024.8, 54.6], [1025.6, 87.6], [1029, 102.5], [1032.1, 107.4], [1076.1, 107.4], [1080, 104.3], [1083.8, 94.2], [1084, 60.2], [1082.8, 51.2], [1073.4, 35.5], [1067, 17.6], [1068.8, 9.5], [1071.7, 6.5], [1071.7, 3.5], [1036.7, 5.3]], 'Attributes': {'class': 'broken'}}]}]}

